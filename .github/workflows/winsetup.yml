name: Setup Windows Server

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  setup-windows-server:
    runs-on: windows-latest

    steps:
      - name: Set up job
        run: echo "Starting Windows Server Setup"
        shell: pwsh

      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install Chocolatey
        run: |
          Write-Host "Checking for Chocolatey..."
          if (-Not (Test-Path "$env:ProgramData\chocolatey")) {
            Set-ExecutionPolicy Bypass -Scope Process -Force; 
            [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072;
            iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
          }
          Write-Host "Chocolatey is installed."
        shell: pwsh

      - name: Install AnyDesk Silently
        run: |
          Write-Host "Installing AnyDesk via Chocolatey..."
          choco install anydesk -y --force | Tee-Object -FilePath "C:\anydesk_choco.log"

          Write-Host "Checking Installation Log..."
          if (Test-Path "C:\anydesk_choco.log") {
            Get-Content "C:\anydesk_choco.log"
          } else {
            Write-Host "No installation log found."
          }

          Write-Host "âœ… AnyDesk Installed Successfully."
        shell: pwsh

      - name: Verify AnyDesk Installation
        run: |
          Write-Host "Checking AnyDesk Process..."
          Get-Process | Where-Object { $_.ProcessName -eq "AnyDesk" } | Format-Table -AutoSize
        shell: pwsh

      - name: Post Check out Repository
        run: echo "Post setup steps completed."
        shell: pwsh
