name: Setup Windows Server

on: [push, pull_request]

jobs:
  setup-windows-server:
    runs-on: windows-latest

    steps:
      - name: Check out Repository
        uses: actions/checkout@v4

      - name: Verify Python Installation
        run: python --version

      - name: Install RustDesk from Repo
        run: |
          $installerPath = "${{ github.workspace }}\rustdesk-1.3.8-x86_64.exe"
          if (Test-Path $installerPath) {
            Write-Host "✅ RustDesk installer found! Installing..."
            Start-Process -FilePath $installerPath -ArgumentList "/S" -NoNewWindow -Wait
            Write-Host "✅ RustDesk installed successfully!"
          } else {
            Write-Host "❌ RustDesk installer not found!"
            exit 1
          }
        shell: pwsh

      - name: Verify RustDesk Installation
        run: |
          $rustdeskPath = "C:\Users\runneradmin\AppData\Local\rustdesk\rustdesk.exe"
          if (Test-Path $rustdeskPath) {
            Write-Host "✅ RustDesk installation verified!"
          } else {
            Write-Host "❌ RustDesk installation failed!"
            exit 1
          }
        shell: pwsh
