name: Setup Windows Server

on: [push, pull_request]

jobs:
  setup-windows-server:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Verify Python Installation
      run: python --version

    - name: Install RustDesk from Repo
      run: |
        $installerPath = "${{ github.workspace }}\rustdesk-1.3.8-x86_64.exe"
        if (Test-Path $installerPath) {
          Write-Host "✅ RustDesk installer found! Installing..."
          Start-Process -FilePath $installerPath -ArgumentList "/S" -Wait -NoNewWindow
        } else {
          Write-Host "❌ RustDesk installer not found!"
          exit 1
        }
      shell: pwsh

    - name: Verify RustDesk Installation
      run: |
        $rustdeskProcess = Get-Process -Name "rustdesk" -ErrorAction SilentlyContinue
        if ($rustdeskProcess) {
          Write-Host "✅ RustDesk is running!"
        } else {
          Write-Host "⚠️ RustDesk process not found. Please check installation."
        }
      shell: pwsh
